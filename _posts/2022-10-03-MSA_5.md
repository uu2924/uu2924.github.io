---
title: "이벤트 스토밍을 통한 마이크로서비스설계"
excerpt: "도메인 주도 설계로 시작하는 마이크로서비스 개발"

categories:
   - MSA
tags:
   -MSA
   -DDD
   -Cloud
last_modified_at: 2022-10-30
published: true
toc: true
toc_sticky: true
toc_label: 목차
---

> 출처: [도메인 주도 설계로 시작하는 마이크로서비스 개발]

### 이벤트 스토밍 ###
이벤트 스토밍은 현실 세계의 도메인을 다양한 색의 포스트잇으로 표현하는 것이다.

#### 이벤트 스토밍 스티커의 유형 ####
1. 도메인 이벤트: 오렌지색  
발생한 사건, 과거시제동사로 표현  

2. 커맨드: 파란색  
도메인 이벤트를 트리거하는 명령

3. 외부 시스템: 핑크색  
도메인 이벤트가 호출하거나 관계있는 레거시 또는 외부 시스템

4. 액터: 작은 노란색  
개인 또는 조직의 역할

5. 애그리커트: 노란색  
도메인 이벤트와 커맨드가 처리하는 데이터, 상태가 변경되는 데이터

6. 청책: 라일락색  
이벤트 조건에 따라 진행되는 결정

7. 읽기 모델: 초록색  
도메인 이벤트 액터에게 제공되는 데이터

8. 사용자 인터페이스: 흰색  
스케치 형태의 화면 레이아웃

9. 핫스폿: 자주색  
의문, 질문, 미결정 사항

#### 이벤트 스토밍 진행 순서 ####
1. 도메인 이벤트 찾기
도메인 이벤트는 비즈니스의 어떤 상태를 생성, 변경, 삭제하는 요소이다.
이벤트는 왼쪽에서 오른쪽으로  시간의 흐름순으로 붙이고, 과거형 동사로 작성한다.  

[그림] 도메인 이벤트 도출  
![ch52_1](https://user-images.githubusercontent.com/50389148/193588249-3cfc237a-5957-47d1-810d-d2c4029be957.PNG)

2. 외부 시스템/ 외부 프로세스 찾기
이벤트를 도출하면서 레거시 시트템이나 외부 시스템과 연계될때 이 프로세스를 작성한다.  

[그림] 외부 시스템 도출  
![ch52_2](https://user-images.githubusercontent.com/50389148/193588223-e319b780-b814-435a-bc69-719af2e2bfff.PNG)

3. 커맨드 찾기
커맨드명은 도메인 이벤트를 동작하게 하는 것으로 동사형태로 작성한다.
조건에따라 하나의 커맨드에 여러개의 이벤트가 발생할 수 있다.  

[그림] 커맨드 도출  
![ch52_3](https://user-images.githubusercontent.com/50389148/193588231-dcef95eb-4b80-4a6e-abd5-8fa4a0fb3195.PNG)

4. 핫스폿 찾기
진행과정에서 의문사항이 생기거나 의사결정이 힘들때 작성한다.  

[그림] 핫스폿 도출  
![ch52_4](https://user-images.githubusercontent.com/50389148/193588234-b344393d-b379-4e7e-847d-2d9e7c1dab5c.PNG)

5. 액터(사용자/역할) 찾기
커맨드를 실행하는 액터를 도출한다.
액터는 사용자 또는 조직, 역할자를 의미한다.
특정 비즈니스를 실제로 수행하는 판매자, 구매자, 배송 관리자 등의 구체적 역할자를 도출하려 노력해야한다.  

[그림] 액터 도출  
![ch52_5](https://user-images.githubusercontent.com/50389148/193588236-a3be5151-dfc2-4de4-b081-515295910257.PNG)

6. 애그리거트 정의하기
커맨드와 도메인 이벤트가 영향을 주는 요소로 DDD의 도메인의 실체 개념을 표현하는 개체인 엔티티가 된다.  

[그림] 애그리거트 도출  
![ch52_6](https://user-images.githubusercontent.com/50389148/193588241-df55a0d0-30ac-4e1b-98a7-dad70cc3da35.PNG)

7. 바운디드 컨텍스트 정의하기
이름이 비슷한 애그리거트는 묶고 다른 애그리거트와는 구분되는 경계를 그린다.  

[그림] 바운디드 컨택스트 도출  
![ch52_7](https://user-images.githubusercontent.com/50389148/193588242-19d749ff-90fd-41dc-a9d4-22785884aa52.PNG)

8 . 컨텍스트 매핑하기
컨텍스트 관계를 작성 할 때에는 동기 방식인지 비동기 방식인지 호출 관계의 방향을 고려한다.
고객이 상품을 주문할 떄 구매 컨텍스트에 동기 방식으로 접근한다.
그리고 구매 컨텍스트와 배송 컨텍스트는 배송 컨텍스트가 장애가 발생해도 주문을 처리할 수 있도록 비동기로 정의했다.  

[그림] 컨택스트 매핑  
![ch52_8](https://user-images.githubusercontent.com/50389148/193588244-b4788307-4e71-42aa-9539-d7a41e93b3a0.PNG)
이렇게 도출된 바운디드 컨텍스트는 마이크로서비스 후보가 된다.
