---
title: "1장 아마존 비즈니스 민첩성의 비밀"
excerpt: "도메인 주도 설계로 시작하는 마이크로서비스 개발"

categories:
   - MSA
tags:
   -MSA DDD
last_modified_at: 2022-09-23
---

# 1장 아마존 비즈니스 민첩성의 비밀

## 1.1 성공한 인터넷 기업들과 비즈니스 민첩성

### 1.1.1 성공 사례: 아마존의 배포 속도
2019년 기준 아마존 서비스의 배포 주기는 초당 1.5번이다. 어떻게 이런 속도를 가지게 됬는지 시스템 관점에서 시스템을 구성하는 인프라와 애플리 케이션 측면에서 살펴본다.

### 1.1.2 클라우드 인프라의 등장
새로운 서비스 개발을 위한 프로젝트를 시작한다고 할 때, 서버나 스토리지 같은 하드웨어, 네트워크. 운영체제 등을 위한 초기 투자비용을 고려해야한다.
그것들을 지속적으로 관리하는 비용 또한 적지 않다. 이러한 환경에서는 좋은 아이디어가 있어도 서비스를 쉽게 런칭해 볼 수 없다. 그러나 최근에는 클라우드 인프라의 등장으로 서비스 개발에 필요한 인프라를 준비하는데 오랜 시간이 들지 않는다. 이것이 비즈니스 민첩성을 촉진한 강력한 요소이다.

### 1.1.3 클라우드 인프라에 어울이는 애플리 케이션의 조건
클라우드 인프라를 이용하면 사용량에 따라 비용이 조정되며 유연하게 용량을 증감할 수 있다.
그리고 여러 개의 서버 장비를 모여 논리적으로 하나처럼 관리되며 분리될수도 있다.
** 스케일 업과 스케일 아웃 **
사용량 증가에 따른 성능 및 가용성을 높이는 방법에는 스케일 업과 스케일 아웃이 있다.
스케일업: 기존 시스템 자체에 물리적 용량을 증가시켜 성능을 높이는 방법(시스템을 담는 그릇을 확장)
스케일아웃: 기존 시스템과 같은 다수의 장비를 병행 추가해서 가용성을 높이는 방법(사용량분산)
** 클라우드 프렌들리와 클라우드 네이티브 **
큰덩어리로 클라우드 환경에 올리갈 수 있게한 어플리케이션을 클라우드 친화 어프리케이션이라고 한다.
독립적으로 분리되어 배포될 수 있는 조각으로 구성된 애플리케이션을 클라우드 네이티브 어플리케이션이라 부른다.


## 1.2 마이크로서비스란 무엇인가? ##

### 1.2.1 모노리스와 마이크로서비스 비교 ###
모노리스는 하나의 단위로 개발되는 일체식 어플리케이션이다. 사용자 인터페이스, 데이터베이스, 서버 어플리케이션의 3부분으로 구성된다.
서버 측 어플리케이션이 단일체로 아무리 작은 변화에도 새로운 버전을 빌드해 배포해야한다. 때문에 확장시 전체 어플리케이션을 동시에 확장해야한다.
반면 마이크로서비스는 서버 측이 여러 조가으로 구성돼 별개의 인스턴스로 로딩된다.
따라서 확장 시에는 특정 기능별로 독립적 확장을 할 수 있고, 해당 서비스만 빌드해서 배포하면 된다.
또한 서비스가 독립적이어서 서로 다른 언어로 개발하는 것이 가능하다.

### 1.2.2 SOA와 마이크로서비스 ###
컴포넌트를 모아 비즈니스적으로 의미 있고 완결적인 서비스 단위로 모듈화하는 SOA(Service Oriented Architechture)와 MSA는 개념적으로는 큰 차이가 없다.
그러나 SOA는 구체적이지 않고 이론적이며, 성공사례가 없지만 MSA는 아마존과 넷플릭스의 비즈니스 성공사례가 널리 공유되고 있다.
[그림] 마이크로서비스 개념도
서비스와 저장소는 다른 서비스 및 저장소와 격리돼 있으며, API를 통해서만 느슨하게 연계된다.
따라서 독립적으로 확장 가능하고 하나의 서비스만 독립적으로 배포 가능하다.
또한 다른 서비스와 연계된 API에 영향을 주지 않으면 내부의 언어나 저장소는 자율적으로 선택할 수 있다.
이처럼 특정 서비스를 구축하는 데 사용되는 언어나 저장소를 자율적으로 선택할 수 있는 방식을 폴리글랏(Polyglot)이라고 한다.


## 1.3 마이크로서비스를 위한 조건은 무엇인가? ##

### 1.3.1 조직의 변화: 업무 기능 중심 팀 ###
마이크로서비스를 만드는 팀은 업무 기능 중심의 팀이어야 한다. 
업무 기능 중심 팀은 기획자, 디자이너, 프런트엔드 개발자, 백엔드 개발자, 설계자, 테스터 등 다양한 역할로 구성된다.
이러한 팀은 마이크로서비스를 만드는 데 필요한 기능과 기술을 팀 내부에 모두 가지고 있으므로 빠르게 의사결정이 진행되고 다른 팀과 느슨하게 연계된다.

### 1.3.2 관리체계의 변화: 자율적인 분권 거버넌스, 폴리글랏 ###
"우리가 만들고 우리가 직접 운영한다"
마이크로서비스팀은 조직의 표준이나 절차를 준수를 강요 받지 않는다. 빠른 서비스를 만드는 것을 최우선 목적으로 두고 효율적인 방법을 찾는다.

### 1.3.3 개발 생명주기의 변화: 프로젝트가 아니라 제품 중심으로 ###
소프트웨어를 완성해야 할 기능들의 집합으로 보는 것이 아니라 비즈니스를 제공하는 제품으로 바라보고, 우선 개발한 뒤에 반응을 보고 개선하는 방식으로 소프트웨어를 개발한다.
애자일(agile) 방식을 채용하여 2~3주 단위의 스프린트(sprint)를 통해 소프트웨어를 배포하고 피드백을 받아 이를 반영한다.

### 1.3.4 개발 환경의 변화: 인프라 자동화 ###
마이크로서비스는 독립적으로 배포된다. 이를 배포하는 가장 좋은 방법은 자동화이다.
개발지원 환경을 자동화하는 데는 소스코드를 빌드하는 도구와 빌드와 동시에 테스트하는 도구, 가상화된 인프라에 배포하는 도구가 모두 필요하다.
빌드/배포 파이프라인은 일반적으로 소스코드 빌드, 개발 환경 배포, 스테이징(staging), 환경 배포, 운영 환경 배포로 구성된다.
이를 효율적으로 관리하기 위해 인프라 구성과 자동화를 마치 소프트웨어처럼 코드로 처리하는 방식인 "Infrastructure as Code"가 각광받고 있다.
[그림] 배포 파이크라인의 자동화

### 1.3.5 저장소의 변화: 통합 저장소가 아닌 분권 데이터 관리 ###
마이크로서비스는 폴리글랏 저장소(polyglot persistence) 접근법을 선택하며, 서비스별로 데이터베이스를 갖도록 설계한다.
즉, 각 저장소가 서비스별로 분산돼 있어야 하며, 다른 서비스의 저장소를 직접 호출할 수 없고 API를 통해서만 접근이 가능하다.
그런데 이러한 구조에서 비즈니스 처리를 위해선 일부 데이터의 복제와 중복 허용이 필요하다.
여기서 발생되는 문제는 각 저장소에 담긴 데이터의 비즈니스 정합성을 맞춰야 하는 데이터 일관성 문제이다.
때문에 마이크로서비스는 비동기 이벤트 처리를 통한 협업을 강조한다. 이를 가리켜 결과적 일관성(Eventual Consistency)이라는 개념으로 표현한다.
이는 두서비스의 데이터가 일시적으로 불일치하는 시점에 있고 일관성이 없는 상태지만 결국에는 두 데이터가 같아진다는 개념이다.
즉, 여러 트랜잭션을 하나로 묶지 않고 별도의 로컬트랜잭션을 각각 수행하고 일관성이 달라진 부분은 체크해서 보상 트랜잭션으로 일관성을 맞추는 개념이다.
마이크로서비스가 추구하는 다른 방법은 각 트랜잭션을 분리하고 큐(queue) 매커니즘을 이용해 보상 트랜잭션을 활용하는 방법이다.
[그림] 협엽을 통한 비즈니스 일관성 확보

## 1.4 정리 ##
MSA는 다양한 사람들이 만나서 협업하는 방식, 조직 문화의 진화된 결과물이다.
MSA를 지향하려면 클라우드 환경에서 비즈니스 민첩성을 강화하기 위한 3가지 요소는
첫째, 유연하고 자동화된 개발 환경 기반의 아키텍쳐
둘째, 자율적인 업무 기능 팀과 개발 문화
셋째, 점진 반복적인 개발 프로세스가 필요하다.

